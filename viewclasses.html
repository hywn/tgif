<style>
input { font-size: 2em; padding: 0.2em }
body {
	margin: 1em 0 0 0;
	display: flex;
	flex-direction: column;
	align-items: center;
	overflow-y: hidden
}
.table {
	margin-top: 1em;
	display: grid;
	grid-template-columns: 1fr min-content min-content min-content min-content 1fr
}
.cell {
	padding: 0.2em;
	white-space: nowrap;
	border: ridge
}
.dsc {
	grid-column: 1;
	direction: rtl;
	overflow: hidden;
	border: none
}
.header { font-weight: bold }
</style>

<h1>all evaluations</h1>
<input id="input" type="text" placeholder="class name, e.g. 'CS 2150'" autofocus />
<div class="table" id="classes"></div>

<script>;(async function(){

const TABLE = document.querySelector('#classes')
const INPUT = document.querySelector('#input')
const DATA  = await fetch(`./classes.php`).then(r => r.json())

const cell = (data, extra='') => `<div class="cell${extra}">${data}</div>`

const display = ([grp, num, responded, class_avg, prof_avg, dsc]) => {
	const link = `<a href="./viewclass.html?class=${grp}+${num}">${grp} ${num}</a>`
	return cell(dsc, ' dsc') + [link, class_avg.toFixed(2), prof_avg.toFixed(2), responded].map(x => cell(x)).join('')
}

const HEADERS  = '<div class="cell dsc"></div>' + ['class', 'class score', 'prof score', '# evals'].map(x => cell(x, ' header')).join('')
const DISPLAYS = DATA.map(clas => [clas[0], clas[1], display(clas)])

let grp    = ''
let num    = ''
let offset = 0
const update_display =
	() => TABLE.innerHTML = HEADERS + DISPLAYS
		.filter(([g, n, disp]) => g.startsWith(grp) && n.startsWith(num))
		.slice(offset, 100)
		.map(([, , disp]) => disp)
		.join('')

const reset  = () => offset = 0
const scroll = amount => offset = Math.max(0, offset + amount)
window.addEventListener('wheel', e => {
	scroll(e.deltaY > 0 ? 1 : -1)
	update_display()
})

INPUT.addEventListener('input', e => {
	const input = INPUT.value
	grp = (input.match(/\w+/i) || [''])[0].toUpperCase()
	num = (input.match(/\d+/)  || [''])[0]

	reset()
	update_display()
})

INPUT.dispatchEvent(new Event('input'))

})();</script>